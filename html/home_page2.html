<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../style/home_page2.css">
    <script src="../script/player_auth.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomePage2</title>
</head>
<body>

    <header>
        <h4 class="sign">Minesweeper</h4>
        
        <h1 class="title" id="welcome-message">Welcome, dear  <span id="user-info"></span>!  </h1>
        <h2 class="subtitle">Are you ready?!?!!</h2>
    </header>

    <section>
        <h3><a href="../html/game_page.html">
            <img src="../media/bomba_white.png"
                class="button"
                id="gogamebutton" 
                alt="Bomb button to go to the game page"
                title="Game">
        </a></h3>
    </section>

    <footer>
        <a href="../html/statistics_page.html">
            <img src="../media/data-analytics.png" 
                class="icon" 
                id="statisticbutton"
                alt="Statistics icon to go to the statistics page"
                title="Statistics">
        </a>

        <a href="../html/rules_page.html">
            <img src="../media/info_red.png"
                class="icon"
                id="info" 
                alt="An icon representing a button to go to the rules page" 
                title="Rules">
        </a>

        <a href="../html/home_page.html">
            <img src="../media/logo.png"
                class="icon"
                id="logoutbutton" 
                alt="LogOut icon to logout(go to the first page)"
                title="LogOut">
        </a>
    </footer>

    <script>
        // 页面加载完成后显示用户信息
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Home page 2 loaded");
            displayUserInfo();
        });

        function displayUserInfo() {
            const currentPlayer = localStorage.getItem('current_player');
            const userInfoSpan = document.getElementById('user-info');
            
            if (currentPlayer) {
                // 获取用户完整信息
                const users = getUsers();
                const currentUser = users.find(user => user.username === currentPlayer);
                
                if (currentUser && currentUser.avatar) {
                    // 创建头像图片和用户名
                    userInfoSpan.innerHTML = `${currentUser.username} <img src="${currentUser.avatar}" alt="Avatar" class="inline-avatar">`;
                    console.log("User info loaded:", currentUser.username, currentUser.avatar);
                } else if (currentUser) {
                    // 只有用户名，没有头像
                    userInfoSpan.textContent = currentUser.username;
                    console.log("User loaded without avatar:", currentUser.username);
                } else {
                    userInfoSpan.textContent = "Guest";
                    console.log("User not found in localStorage");
                }
            } else {
                userInfoSpan.textContent = "Guest";
                console.log("No current player found");
                
                // 如果没有登录用户，重定向到登录页面
                setTimeout(() => {
                    window.location.href = '../html/home_page.html';
                }, 2000);
            }
        }
    </script>

</body>
</html>